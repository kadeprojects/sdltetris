diff -uartN gcc-11.1.0-org/gcc/config/i386/ia32intrin.h gcc-11.1.0/gcc/config/i386/ia32intrin.h
--- gcc-11.1.0-org/gcc/config/i386/ia32intrin.h	2021-04-27 12:00:13.000000000 +0200
+++ gcc-11.1.0/gcc/config/i386/ia32intrin.h	2021-04-30 22:13:43.277630800 +0200
@@ -107,12 +107,22 @@
 #endif /* __iamcu__ */
 
 /* rdtsc */
-#define __rdtsc()               __builtin_ia32_rdtsc ()
+extern __inline unsigned long long
+__attribute__((__gnu_inline__, __always_inline__, __artificial__))
+__rdtsc (void)
+{
+  return __builtin_ia32_rdtsc ();
+}
 
 #ifndef __iamcu__
 
 /* rdtscp */
-#define __rdtscp(a)             __builtin_ia32_rdtscp (a)
+extern __inline unsigned long long
+__attribute__((__gnu_inline__, __always_inline__, __artificial__))
+__rdtscp (unsigned int *__A)
+{
+  return __builtin_ia32_rdtscp (__A);
+}
 
 #endif /* __iamcu__ */
 
diff -uartN gcc-11.1.0-org/gcc/cp/module.cc gcc-11.1.0/gcc/cp/module.cc
--- gcc-11.1.0-org/gcc/cp/module.cc	2021-04-27 12:00:13.000000000 +0200
+++ gcc-11.1.0/gcc/cp/module.cc	2021-04-29 12:33:02.006392800 +0200
@@ -19829,8 +19829,7 @@
             for (unsigned again = 2; ; again--)
               {
                 fd = open (tmp_name,
-                           O_RDWR | O_CREAT | O_TRUNC | O_CLOEXEC | O_BINARY,
-                           S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH);
+                           O_RDWR | O_CREAT | O_TRUNC | O_CLOEXEC | O_BINARY);
                 e = errno;
                 if (fd >= 0 || !again || e != ENOENT)
                   break;
diff -uartN gcc-11.1.0-org/gcc/pretty-print.c gcc-11.1.0/gcc/pretty-print.c
--- gcc-11.1.0-org/gcc/pretty-print.c	2021-04-27 12:00:13.000000000 +0200
+++ gcc-11.1.0/gcc/pretty-print.c	2021-04-28 21:10:46.926766800 +0200
@@ -42,6 +42,14 @@
 #include <io.h>
 #define WIN32_LEAN_AND_MEAN 1
 #include <windows.h>
+ 
+#ifndef COMMON_LVB_REVERSE_VIDEO
+#define COMMON_LVB_REVERSE_VIDEO 0x4000
+#endif
+
+#ifndef COMMON_LVB_UNDERSCORE
+#define COMMON_LVB_UNDERSCORE 0x8000
+#endif
 
 /* Write all bytes in [s,s+n) into the specified stream.
    Errors are ignored.  */
diff -uartN gcc-11.1.0-org/libstdc++-v3/libsupc++/del_opa.cc gcc-11.1.0/libstdc++-v3/libsupc++/del_opa.cc
--- gcc-11.1.0-org/libstdc++-v3/libsupc++/del_opa.cc	2021-04-27 12:00:16.000000000 +0200
+++ gcc-11.1.0/libstdc++-v3/libsupc++/del_opa.cc	2021-04-28 21:11:35.212528600 +0200
@@ -24,6 +24,7 @@
 // <http://www.gnu.org/licenses/>.
 
 #include <bits/c++config.h>
+#include <malloc.h>
 
 #if !_GLIBCXX_HOSTED
 // A freestanding C runtime may not provide "free" -- but there is no
@@ -50,7 +51,7 @@
     || _GLIBCXX_HAVE_MEMALIGN
   std::free (ptr);
 #elif _GLIBCXX_HAVE__ALIGNED_MALLOC
-  _aligned_free (ptr);
+  __mingw_aligned_free (ptr);
 #else
   if (ptr)
     std::free (((void **) ptr)[-1]); // See aligned_alloc in new_opa.cc
diff -uartN gcc-11.1.0-org/libstdc++-v3/libsupc++/new_opa.cc gcc-11.1.0/libstdc++-v3/libsupc++/new_opa.cc
--- gcc-11.1.0-org/libstdc++-v3/libsupc++/new_opa.cc	2021-04-27 12:00:16.000000000 +0200
+++ gcc-11.1.0/libstdc++-v3/libsupc++/new_opa.cc	2021-04-28 21:12:03.523147900 +0200
@@ -24,6 +24,7 @@
 // <http://www.gnu.org/licenses/>.
 
 #include <bits/c++config.h>
+#include <malloc.h>
 #include <stdlib.h>
 #include <stdint.h>
 #include <bit>
@@ -68,7 +69,7 @@
 #elif _GLIBCXX_HAVE__ALIGNED_MALLOC
 static inline void*
 aligned_alloc (std::size_t al, std::size_t sz)
-{ return _aligned_malloc(sz, al); }
+{ return __mingw_aligned_malloc(sz, al); }
 #elif _GLIBCXX_HAVE_POSIX_MEMALIGN
 static inline void*
 aligned_alloc (std::size_t al, std::size_t sz)
